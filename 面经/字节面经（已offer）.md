## 介绍
17年毕业双非一本。面试抖音社区安全部门，以java进行面试。

## 字节一面
1. 先进行自我介绍
2. 问：数据库，中间件用了什么？答：mysql+postgres+kafka+redis
3. 问：有用过ThreadLocal吗？使用的场景是什么？答：用过，在登录的时候记录用户的登录信息。
4. 问：具体怎么实现？答：在拦截器中对token进行解析，然后将用户信息写入ThreadLocal。
5. 问：拦截器具体要实现哪个接口记得吗？答：不记得。
6. 问：有的接口需要进行登录判断，有的不需要这个怎么处理？答：使用注解，标记不需要登录判断的接口。
7. 问：ThreadLocal原理有了解吗？答：内部是一个Map，由线程持有，这是它线程安全的原因。ThreadLocal与Map之间是弱引用，误用会造成内存泄漏。
8. 问：为什么会造成内存泄漏？答：弱引用在GC时会被回收，由于线程还是活跃的，还是有强引用在Value上，所以value不会被回收，但是Map中对应的key会变成null。
9. 问：什么时候去请求key为null的数据（如何避免）？答：get/set/remove（和面试官产生分歧，我坚持自己印象中的内容），使用完ThreadLocal之后及时remove。
10. 问：线程池核心参数？答：五个，核心线程数、最大线程数、最长活跃时间、阻塞队列、拒绝策略。
11. 问：阻塞队列用过哪些，使用场景是怎么样的？答：只用过 ArrayBlockingQueue和PriorityBlockingQueue。
12. 问：锁升级过程？答：~
13. 问：遇到过线上JVM问题吗？答：没有
14. 问：线上JVM配置是怎么样的？答：设置最大堆，最小堆，gc收集器为 G1
15. 问：为什么线上使用G1？答：没想过。。。
16. 问：G1和CMS什么区别？答：CMS多线程并发，采用标记清除算法，追求更快的GC速度。G1将内存分为小块，追求更高的回收效率。
17. 问：什么时候用G1，什么时候用CMS？答：不清楚
18. 问：介绍下项目，和一些细节？答：。。。主要介绍一下项目背景和方案，然后将一下有亮点的设计，比如为何要这样设计：我有个设计就是借用了HashMap的链表变红黑树的阈值8，红黑树变链表的阈值时6这个思想（留下一定的缓冲空间避免频繁变化）。然后可以谈谈这个方案的不足，与改进的方向与思考。
19. 问：解决热点key的方案？答：1.内存缓存 2.拆分多份
20. 问：限流算法？答：窗口计数，漏桶，令牌桶（详细解释一下）
21. 问：分别使用的场景？答：不清楚
22. 问：分布式情况下如何实现漏桶和令牌桶？答：令牌桶可以以一定速率写到redislist中，然后接口上来先拿一个令牌。漏桶不知道。
23. 问：mysql什么时候用主库，什么时候用从库？答：事务，写用主，读操作用从。因对主从复制延迟，需要马上知道的数据，使用主。
24. 问：主从复制，基于什么？答：binlog，复制八股文。
25. 问：主从复制有几个线程？答：这里答错了，应该是有三种线程。
26. 问：主从复制模式？答：同步，半同步，异步（介绍）。
27. 问：半同步是等待几个从回答？答：一个。
28. 问：binlog 模式？（这里应该是想问binlog的格式）答：不知道（应该是 statement，row，mixed）
29. 算法：有一个递增数组，但是拥有重复数字，需要原地将重复数字移到数组的后面。
比如
[10,11,11,12,12,12,13,14,15,15,15]
移动之后
[10,11,12,13,14,15,11,12,12,15,15] 
前面的部分自增有序，后面的部分，不要求递增与有序
空间复杂度要求为 O(1)

总结：这轮面试，答得不是很好，很多东西都没答上来，最后的算法也写了有二十多分钟。总得来看表现不是特别好，但还是过了面试。给我的面评大概是说，技术方案粗糙，缺少指导，算法卡了挺久。
平时还是更注重积累一些工具的使用场景。

## 字节二面
1. 自我介绍
2. 介绍项目（很细，各种细节，持续了半个多小时）
3. 问：Redis zset 结构，底层数据结构。答：ziplist，跳表+字典
4. 问：跳表的数据结构。答：多层的链表结构
5. 问：跳表的插入过程。答：略
6. 问：如何确定层数。答：抛硬币算法
7. 问：为什么要用抛硬币，解决什么问题。答：应该是为了让层数分布更均衡（不确定）
8. 问：抛硬币正反面概率是50%吗？答：不清楚
9. 问：跳表查询过程。答：略
10. 问：数据重复怎么办。答：字典+跳表。score 不一样，再插入一个。值一样，更新score
11. 问：http 协议了解吗？答：了解不是特别多（跳过了）
12. 问：常用索引类型？答：聚簇索引，非聚簇索引。
13. 问：非聚簇索引与聚簇索引使用说明数据结构？答：使用B+Tree
14. 问：B+Tree有哪些好处？答：1. 优化IO 2. 方便范围查询 3. 局部访问原则
15. 问：B Tree 与 B+Tree 的区别？答：B Tree 节点上存数据，IO 更多。范围查找支持不好
16. 问：非聚簇索引与聚簇索引的却别？答：非聚簇索引只存索引与主键。
17. 问：ABC 三个字段联合索引，什么时候不需要回表？答：只查询id+ABC三个字段不需要回表
18. 问：ABC联合索引，where A and B > 2 and C =3，能否使用索引，为什么？答：A,B能用，C不行。最左前缀原则。（但是不会回表，c=3 会由索引下推规则判断）
19. 问：原子性如何实现？答：支持rollback，由 undolog 实现
20. 问：事务开启到回滚如何实现？答：略
21. 问：undolog 存的是什么？答：逻辑日志，记录改动内容
22. 问：持久性如何实现？答：保证 crash-safe 能力，redolog + binlog 的二阶段提交。
23. 问：如何表现？答：二阶段提交过程（略）
24. 问：事务提交成功，redolog 可能没写到磁盘吗？答：redolog 不 fsync （redo log 刷盘的三个策略）（事务没提交也可能已经落盘）。
25. 问：此时能否保证数据不丢？答：不行。
26. 设计题：设计拼手气红包（并发是春晚发红包）？答：（避免重复抢、红包分配问题、超发问题）略。
27. 算法：[最长无重复子串](!https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/solution/)