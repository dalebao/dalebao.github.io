# MySQL的结构与更新流程

## MySQL 的结构

mysql 主要分为 server 层以及存储引擎层。

server 层主要包括：

1. 连接器：负责跟客户端建立链接、获取权限、维持和管理链接。
2. 查询缓存：之前执行过的语句会以 key-value 的形式缓存在内存中，不建议使用（数据更新频繁的场景下，可以用 SQL_CACHE 显示的开启）。
3. 分析器：词法分析，判断词法是否正确，确定是查询、更新、插入或者删除操作。
4. 优化器：在表中有多个索引的时候，判断使用哪个索引。
5. 执行器：从存储引擎中获取对应的数据

存储引擎主要支持：

1. InnoDB
2. MyISAM
3. Memory

## Update 语句执行流程（InnoDB）

1. 执行器向存储引擎要 满足 where 条件的数据
1. 如果本来就存在于内存，直接返回
1. 不存在，则读取磁盘后返回
1. 执行器拿到数据，做指定的修改，然后交给存储引擎存储
1. 引擎将数据更新到内存，同时将数据记录到 redo log 中，此时 redo log 为 prepare 状态，告知执行器随时可以提交事务。
1. 执行器生成这个操作的 binlog，并将数据写入磁盘。
1. 执行器调用 引擎的提交接口，将 redo log 改为 commit 状态。
